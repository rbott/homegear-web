{% extends "index.html" %}

{% block content %}
<div class="container">
{% for msg in serviceMessages %}
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="alert alert-danger" role="alert">
                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                <span class="sr-only">Error:</span>
                {{ msg.deviceName }}: {{ msg.message }}
            </div>
        </div>
    </div>
{% endfor %}
	<div class="row">
		<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
			<div class="panel panel-default settings-box">
				<div class="panel-heading">Set Temperature for all/selected Valves</div>
				<div class="panel-body">
					<form method="POST" action="setAllTemp">
						<div class="form-group">
							<input type="range" min="12" max="29" step="1" name="targetTemp" value="17" data-rangeslider />
							<output class="output"></output>
						</div>
						<div class="row">
{% for device in devices %}
{% if device.getType() == "valve" %}
								<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3">
									<div class="checkbox"><label><input type="checkbox" name="valves[]" checked value="{{ device.getPeerId() }}">{{ device.getName() }}</label></div>
								</div>
{% endif %}
{% endfor %}
						</div>
						<div class="row">
							<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
								<button type="submit" class="btn btn-default">Set Temperature</button>
							</div>
						</div>
					</form>		
				</div>
			</div>	    
		</div>
{% for device in devices %}
{% if device.getType() == "valve" %}
		<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
			<div class="panel panel-default settings-box">
				<div class="panel-heading"><div>{{ device.getName() }} <span class="label label-success">{{ device.valveState }}%</span></div></div>
				<div class="panel-body">
					<div class="progress">
						<div class="progress-bar" role="progressbar" aria-valuenow="{{ device.tempSensor }}" aria-valuemin="0" aria-valuemax="30" style="width: {{ device.tempSensor / 30 * 100  }}%">
							Temp: {{ device.tempSensor }}Â°C
						</div>
					</div>
					<form method="POST" action="/setTemp">
						<div class="form-group">
							<input type="range" min="12" max="29" step="1" name="targetTemp" value="{{ device.targetTemp }}" data-rangeslider />
							<output class="output"></output>
						</div>
						<div class="form-group">
							<input type="hidden" name="peerId" value="{{ device.getPeerId() }}" />
						</div>
						<div class="row text-center">
							<div class="col-xs-6">
								<button type="submit" class="btn btn-default">Apply</button>
							</div>
							<div class="col-xs-6">
								<a class="btn btn-primary" href="/valveDetails/{{ device.getPeerId() }}" />Details</a>
							</div>
						</div>
					</form>
				</div>
			</div>	    
		</div>
{% endif %}
{% if device.getType() == "pwrsensor" %}
		<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">
			<div class="panel panel-default settings-box">
                <div class="panel-heading"><div>{{ device.getName() }} {% if device.enabled %}<span class="label label-success">on{% else %}<span class="label label-danger">off{% endif %}</span></div></div>
				<div class="panel-body">
					<form method="POST" action="/togglePwr">
						<div class="form-group">
							<input type="hidden" name="peerId" value="{{ device.getPeerId() }}" />
						</div>
						<div class="row text-center">
							<div class="col-xs-6">
								<button type="submit" class="btn btn-default">Toggle</button>
							</div>
							<div class="col-xs-6">
								<a class="btn btn-primary" href="/valveDetails/{{ device.getPeerId() }}" />Details</a>
							</div>
						</div>
					</form>
				</div>
			</div>	    
		</div>
{% endif %}

{% endfor %}
	</div>
</div>
{% endblock %}
